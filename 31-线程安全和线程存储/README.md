## 第31章 线程安全和线程存储

### 线程安全：可重入性

导致线程不安全的原因是：使用了所有线程之间共享的全局或静态变量

实现线程的方式：其一是将函数与互斥量关联使用、其二是将共享变量与互斥量关联起来

相比较于整个函数使用互斥量，使用临界区实现线程安全虽有改善，还是有些低效，而可重入函数则无需使用互斥量即可实现线程安全，其要诀在于避免对全局或静态变量的使用，需要返回给调用者的信息，都存储于调用者分配的缓冲区内，不过并非所有函数都可以实现为可重入，原因如下：

* 有些函数必须访问全局数据结构，如malloc函数库
* 一些函数的接口在线程发明之前本身就被定为为不可重入，如asctime

对于后缀是_r的可重入函数，要求由调用者分配缓冲区