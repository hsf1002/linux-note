### 第3章 系统编程概念

##### 系统调用

只要执行系统调用或者库函数，检查返回状态以确定调用是否成功，是编程的一条铁律

系统调用与库函数很像，其幕后会经历诸多步骤：

1. 通过调用C语言库函数的外壳函数，发起系统调用
2. 对系统调用中断处理例程来说，外壳函数必须保证所有的系统调用参数可用
3. 内核需要区分每个系统调用，将系统编号复制到一个特殊的寄存器
4. 外壳函数执行一条中断指令int 0x80，引发处理器从用户态切到核心态，并执行系统中断0x80的中断矢量所指向的代码
5. 为了响应中断0x80，内核会调用system_call来处理这次中断
   * 内核栈中保存寄存器
   * 审核系统调用编号的有效性
   * 以系统调用编号存放所有调用服务的列表（内核变量sys_call_table）进行索引，发现并调用相应的系统服务
   * 从内核栈中恢复各个寄存器，将系统调用返回值放在栈中
   * 返回外壳函数，同时将处理器切回用户态
6. 若系统调用例程的返回值表明调用有误，外壳函数使用该值设置全局变量errno，然后外壳函数返回到调用程序，同时返回一个整型值，表明系统调用是否成功

一个简单的系统调用，也要完成相当多的工作，因此系统调用开销虽小，却不容忽视

##### 库函数

许多库函数不会使用任何系统调用，有些库函数构建于系统调用层之上，比如fopen利用open来执行打开文件的实际操作，又如printf相对于write，设计库函数为了提供比底层更为方便的调用接口

##### 标准C语言函数库：glibc

确定系统的glibc版本：

```
/lib/libc.so.6
```

发现glic共享库的路径：

```
ldd prog | grep libc
```

