### 第14章 文件系统

##### 设备专有文件

* 字符型设备：基于字符处理数据，如终端和键盘
* 块设备：每次处理一块数据，一般都是512字节，如磁带和磁盘

通常位于/dev下，超级用户可以使用mknod命令创建设备文件，特权程序可通过mknod()系统调用实现相同功能，udev程序所依赖的sysfs文件系统，是装载于/sys下的伪文件系统，将设备和其他内核对象的相关信息导出到用户空间

每个设备都有主、辅ID号，主ID标识一般的设备等级，内核会根据主ID查找对应的驱动程序，辅ID能够在同一等级中标识唯一特定设备，命令ls -l可显示出设备文件的主辅ID，每个设备的驱动程序都会将自己与特定主设备号的关联关系向内核注册，以此建立设备专用文件和设备驱动程序之间的关系，内核是不会使用设备文件名查找驱动程序的

##### 磁盘和分区

磁盘驱动器是一种机械装置，由一个或多个高速旋转的盘片组成，通过在磁盘上快速移动读写磁头，可获取/修改磁盘表面的磁性编码信息，磁盘表面信息物理上存储于磁道的一组同心圆上，其又被划分为若干扇区，每个扇区包括一系列物理块，物理块的容量一般是512字节，代表驱动器可以读写的最小信息单元。首先磁头要移动到相应的磁道（寻道时间），然后再相应扇区旋转到磁头下之前，驱动器必须一直等待（旋转延迟），最后还要从所请求的块上传输数据（传输时间），上述操作通常以毫秒计数

每个磁盘可划分为多个分区，内核视每个分区为/dev下的单独设备，系统管理员使用fdisk决定磁盘分区的编号、大小和类型，fdisk -l会列出磁盘上所有分区，Linux专有文件/proc/partitions记录了系统中每个磁盘分区的主副设备编号、大小和名称，磁盘分区可容纳任何类型的信息，通常只包含以下之一：

* 文件系统：用来存放常规文件
* 数据区域：作为裸设备对其进行访问
* 交换区域：供内核的内存管理使用

mkswap命令可创建交换区域，特权进程可用swapon系统调用向内核报告将磁盘分区用作交换区域，swapoff系统调用执行相反功能，即告知内核停止将磁盘分区作为交换区域，可使用Linux专有文件/proc/swaps查看系统中当前以及激活的交换区域的信息

##### 文件系统

文件系统时对常规文件和目录的组织集合，创建文件系统的命令式mkfs，Linux支持种类繁多的文件系统

* 传统的ext2文件系统
* 原生UNIX文件系统，如Minix、System V、BSD
* 微软的FAT、FAT32、NTFS
* ISO CD-ROM文件系统
* Apple Macintosh的HFS
* 一系列日志文件系统，如ext3、ext4、Reiserfs、JFS、XFS、Btrfs

Linux专有的文件/proc/filesystems可以查看当前内核所识别的文件系统类型

ext2随着日志文件系统的兴起，使用日趋减少，但其概念较为通用，文件系统的组成部分：

* 引导块：总是作为文件系统的首块，不为文件系统使用，只是包含用来引导操作系统的信息
* 超级块：紧随引导块的一个独立块，包含与文件系统有关的参数信息，如i节点容量、文件系统中逻辑块大小，文件系统的大小等
* i节点表：记录着文件系统中每个文件与目录
* 数据块：文件系统中大部分空间都用于存放数据

